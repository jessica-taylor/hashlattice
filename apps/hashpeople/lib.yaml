data: {}
code: |
  function(hl) {
    var exports = {};
    exports.profileVar = function(publicKey) {
      return {
        data: {publicKey: publicKey},
        code: 'cl.makeDatedPost(publicKey)'
      };
    };
    exports.getProfile = function(publicKey) {
      var signed = hl.getVar(exports.profileVar(publicKey));
      return signed && signed.value;
    };
    exports.putProfile = function(profile) {
      var privKey = hl.getLocal('privateKey');
      if (privKey) {
        hl.putVar(exports.profileVar(hl.getLocal('publicKey')), cl.datedPostValue(privKey, new Date().getTime(), profile));
        return true;
      } else {
        return false;
      }
    };
    exports.getPrivateKey = function() {
      return hl.getLocal('privateKey');
    };
    exports.getPublicKey = function() {
      return hl.getLocal('publicKey');
    };
    exports.getMyProfile = function() {
      var pubKey = exports.getPublicKey();
      if (!pubKey) return null;
      return exports.getProfile(pubKey);
    };
    exports.setKeys = function(privateKey, publicKey) {
      hl.setLocal('privateKey', privateKey);
      hl.setLocal('publicKey', publicKey);
    };
    exports.genKeyPair = function() {
      var keys = cl.genKeyPair();
      hl.putLocal('privateKey', keys.private);
      hl.putLocal('publicKey', keys.public);
      return keys;
    };
    exports.getFriendsVar = function(publicKey) {
      return {
        data: {publicKey: publicKey},
        code: 'cl.makeSet()'
      };
    };
    exports.getMyFriends = function() {
      var pubKey = exports.getPublicKey();
      if (!pubKey) return null;
      return exports.getFriends(pubKey);
    };
    exports.putWallPost = function() {
      // TODO : this
    };
    return exports;
  }
